<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.team2.fithub.model.dao.ProgramDao">

	<insert id="insertProgram" parameterType="Program" useGeneratedKeys="true" keyProperty="id">
		INSERT INTO program (
			mentorId, categoryId, title, reservationStartDate, reservationEndDate,
			programStartDate, programEndDate, thumbnail, content, youtubeUrl,
			latitude, longitude
		)
		VALUES (
			#{mentorId}, #{categoryId}, #{title}, #{reservationStartDate}, #{reservationEndDate},
			#{programStartDate}, #{programEndDate}, #{thumbnail}, #{content}, #{youtubeUrl},
			#{latitude}, #{longitude}
		)
	</insert>
	
	<select id="selectProgram" resultType="Program">
		SELECT * FROM program
		WHERE id = #{id}
	</select>
	
	<select id="selectAllProgram" resultType="Program">
		SELECT * FROM program
	</select>
	
	<!-- 프로그램 검색 -->
	<select id="searchProgram" parameterType="SearchCondition" resultType="Program">
	    SELECT p.*
	    FROM Program p
	    JOIN (
	        SELECT DISTINCT programId
	        FROM Time
	        WHERE 
	            <trim prefixOverrides="AND">
	                <if test="sunday"> AND startTime &gt; #{convertedStartTime} AND endTime &lt; #{convertedEndTime}</if>
	                <if test="monday"> AND startTime &gt; #{convertedStartTime} AND endTime &lt; #{convertedEndTime}</if>
	                <if test="tuesday"> AND startTime &gt; #{convertedStartTime} AND endTime &lt; #{convertedEndTime}</if>
	                <if test="wednesday"> AND startTime &gt; #{convertedStartTime} AND endTime &lt; #{convertedEndTime}</if>
	                <if test="thursday"> AND startTime &gt; #{convertedStartTime} AND endTime &lt; #{convertedEndTime}</if>
	                <if test="friday"> AND startTime &gt; #{convertedStartTime} AND endTime &lt; #{convertedEndTime}</if>
	                <if test="saturday"> AND startTime &gt; #{convertedStartTime} AND endTime &lt; #{convertedEndTime}</if>
	            </trim>
	    ) AS filteredPrograms ON p.id = filteredPrograms.programId
	    WHERE 
	        <if test="categoryId == 0">
	            1=1 <!-- Always true condition to ensure WHERE clause is valid even when no other conditions are present -->
	        </if>
	        <if test="categoryId != 0">
	            p.categoryId = #{categoryId}
	        </if>
	    ORDER BY 
	        <if test="order != null"> #{order} #{direction}</if>
	</select>

	
</mapper>